// workflow parameters
params {
	
	// IMPORTANT WORKFLOW SETTINGS
	// These are settings that should be reviewed each time the workflow is run.
	// ------------------------------------------------------------------------
	
	// Samplesheet for specific sequences to download from EMBL
	// We recommend you use the sheet included in resources/ as a model.
	// The sheet must have 5 columns: INDSC accession ("accession"), formal 
	// allele name ("formal_name"), informal allele name ("informal_name"), 
	// IPD identifier ("ipd_id"), and animal identifier ("animal_id").
	// NOTE: the columns informal_name, ipd_id, and animal_id can be left blank
	// if this information is unavailable.
	added_seqs = "$launchDir/resources/embl_samplesheet.csv"
	
	// which databases to pull. The more databases you pull, the longer the workflow will take, depending on the number of cores available. Options are true or false.
	pull_hla = false
	pull_mhc = true
	pull_kir = true
	pull_mhc_proteins = true
	pull_kir_proteins = true
	pull_added_seqs = false // this requires the samplesheet, specified above
	
	// which processing steps to complete (more details about these in README.md)
	trim_for_exon2 = true
	trim_for_iwes = true
	trim_for_miseq = true

	// previous IPD release date. This parameter will be updated by the workflow maintainer.
	last_release_date = "2022-02-01"
	
	// number of records to pull for each database. *These must be set manually!*
	hla_allele_count = 37800 // number of alleles in the IPD IMGT/HLA database, found near the bottom right at https://www.ebi.ac.uk/ipd/imgt/hla/alleles/. Last updated 2023-08-30
	mhc_allele_count = 12195 // number of alleles in the IPD NHP MHC database, found near the bottom right at https://www.ebi.ac.uk/ipd/mhc/allele/list/ and then double-checked with custom urls like "https://www.ebi.ac.uk/Tools/dbfetch/dbfetch?db=ipdmhc;id=NHP10958;style=raw". NOTE: At this time, IPD lists 12094 alleles on their website, but only 10958 are available on EBI via their dbfetch tool. Last updated 2023-08-30
	kir_allele_count = 1189 // number of alleles in the IPD KIR database, found near the bottom right at https://www.ebi.ac.uk/ipd/kir/alleles/ and then double-checked with custom urls like "https://www.ebi.ac.uk/Tools/dbfetch/dbfetch?db=ipdnhkir;id=NHP01212;style=raw". NOTE: At this time, IPD lists 1550 alleles on their website, but only 1212 are available on EBI via their dbfetch tool. Last updated 2023-08-30
	mhc_protein_count = 2974 // number of records in ipdmhcpro
	kir_protein_count = 1212 // number of records in ipdnhkirpro
	
	// which animals to download (feature in development)
	// animals = "mamu,mafa,mane"
	
	// ------------------------------------------------------------------------
	
	
	// AUXILIARY FILES
	resources = "$projectDir/resources"
	iwes_exemplar = "$baseDir/resources/Mamu-exon2-exemplar.fasta" // immuno-whole-exome-sequencing (iWES) exemplar file
	miseq_exemplar = "$baseDir/resources/Mamu_MiSeq_representative_alleles.fasta" // Illumina MiSeq Amplicon exemplar file
	
	
	// WHERE TO PLACE OUTPUTS
	// path for where to place workflow results (default is results/)
	results = "$launchDir/results"

	// DATE AT BEGINNING OF RUN
	date = new java.util.Date().format('yyyy-MM-dd')

	// CPU SETTINGS
	// Find number of CPUs on system or node
	available_cpus = Runtime.getRuntime().availableProcessors() - 1

	// Find the maximum number of cpus to allocate for local execution that
	// is not on an HPC cluster
	max_shared_cpus = Math.floor( Runtime.getRuntime().availableProcessors() / 4 )

}


cleanup = true


manifest {
	homePage = 'https://github.com/dholab/IPD-ref-generator'
	mainScript = 'ipd-ref-generator.nf'
	defaultBranch = 'main'
	description = 'Workflow for generating useful immunological gene allele databases'
	author = 'Nicholas R. Minor'
}


// Changing default workflow-visualizing configuration to true
dag {
	enabled = true
	overwrite = true
	file = 'ipd-ref-gen-dag.png'
}


// Changing default to not collecting run stats
timeline {
	enabled = false
	// overwrite = true
	file    = "${params.results}/timeline.html"
}

report {
	enabled = false
	// overwrite = true
	file    = "${params.results}/report.html"
}

// Setting profiles
profiles {

	standard {

		process.executor = 'local'
		docker.enabled = true
		podman.enabled = false
		singularity.enabled = false
		conda.enabled = false
		process.container = 'nrminor/ipd-ref-generator:v1.1'
		
	}

	chtc {

		process.executor = 'condor'
		process.cpus = 1
		process.disk = '2 GB'
		process.memory = '2 GB'

	}

	podman {
		
		process.executor = 'local'
		docker.enabled = false
		podman.enabled = true
		singularity.enabled = false
		conda.enabled = false
		process.container = 'docker.io/nrminor/ipd-ref-generator:v1.1'
	
	}

}
